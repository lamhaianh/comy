== Prequisites

* Java 1.6
* Cassandra 0.6.0+

== Configure Cassandra

Config Cassandra, add to <Keyspaces>:

<Keyspace Name="comy">
    <ColumnFamily Name="ShortenURL" CompareWith="UTF8Type"/>
    <ColumnFamily Name="LongURL"    CompareWith="UTF8Type"/>
    <ColumnFamily Name="AccessTime" CompareWith="UTF8Type"/>

    <ReplicaPlacementStrategy>org.apache.cassandra.locator.RackUnawareStrategy</ReplicaPlacementStrategy>
    <ReplicationFactor>2</ReplicationFactor>
    <EndPointSnitch>org.apache.cassandra.locator.EndPointSnitch</EndPointSnitch>
</Keyspace>

<Seeds>
    <Seed>192.168.1.233</Seed>
    <Seed>192.168.1.66</Seed>
</Seeds>

== Config Comy

Before running the service, you must configure it. Copy
"project/config.properties.sample" to "project/config.properties". You can just
use the default configuration or re-config it.

- SERVER_PORT: port where you want to run your service. Please note that you
should not use port 8080 if you intend to run Cassandra on the same machine since
Cassandra will also use this port for RMI.
- DB_HOST: Cassandra host name or IP
- DB_PORT: Cassandra port
- DB_KEYSPACE, DB_SHORT_URL_CF, DB_LONG_URL_CF, DB_ACCESS_TIME_CF: these
configurations are related to the database schema. Their values are linked with
Cassandra configurations. Use the default values if you are not sure and going
to use our Cassandra configuration file.
- EXPIRATION_DATE: if the URL has not been accessed for a certain number of
days, it will be removed by the GarbageCollector proccess
- ALLOWED_IP: a list of allowed clients' IPs serparated by comma. To allow all IP, set ALLOWED_IP = *

Replace or merge your Cassandra config file with "project/storage-conf.xml".
You may want to modify <Seed></Seeds> and <ListenAddress></ListenAddrress> to
match your IP and where you want to use cluster for data replication.

== Run

java -jar comy.jar ...

== Use

- To ask for a shorten key, send request to the service with param "url"
set to the long URL that you want to be shorten. For example, you can test
by typing "http://localhost:8888/url=http://my_long_url.com" into your browser
(assuming that the service is running on your localhost on port 8888). Assuming
that the return string is "abcdefg". To use the shorten key, type
"http://localhost:8888/abcdefg" into your browser, you will be redirected to
http://my_long_url.com

== Remove old data

Schedule (using crontab on Linux etc.) this to be run periodically:
java -jar comy.jar ...
